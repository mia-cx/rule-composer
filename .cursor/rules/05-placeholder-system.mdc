---
description: "Placeholder resolution: {{VAR}} syntax, empty-var line removal, passthrough"
globs: scripts/**/*.ts
alwaysApply: false
---

# Placeholder System

Rules use `{{VARIABLE_NAME}}` syntax. `resolvePlaceholders(content, toolId)` handles resolution.

## Resolution rules

1. `{{VAR}}` with non-empty value → replaced with the value
2. `{{VAR}}` with empty string → **entire line removed** (not just the placeholder)
3. Unknown `{{VAR}}` → left as-is (passthrough)

## Line removal is critical

When a rule mentions `{{SKILLS_DIR}}` and the target tool has no skills concept (empty value), the whole line disappears. This avoids broken references like "Use for skills." with no path.

If a line has mixed placeholders (one empty, one non-empty), the line is **still removed** — any empty var kills the line.

## Identifying dynamic rules

`readRule()` sets `hasPlaceholders: true` when `\{\{\w+\}\}` is found in the body. The CLI uses this to show which rules are dynamic vs static.

## Available variables

`TOOL_NAME`, `RULES_DIR`, `RULES_EXT`, `SKILLS_DIR`, `SKILLS_EXT`, `AGENTS_DIR`, `COMMANDS_DIR`, `GLOBAL_RULES`, `GLOBAL_SKILLS`, `GLOBAL_AGENTS`, `GLOBAL_COMMANDS`, `RULE_EXAMPLE`

Project-level: `RULES_DIR`, `SKILLS_DIR`, `AGENTS_DIR`, `COMMANDS_DIR`. Global: `GLOBAL_*`. For tools without agents/commands, `AGENTS_DIR` and `COMMANDS_DIR` are empty (lines using them are removed).

See `TOOL_VARIABLES` in `scripts/shared/formats.ts` for the full per-tool map.
